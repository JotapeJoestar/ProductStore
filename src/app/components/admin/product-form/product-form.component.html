<div class="admin-logo text-center"><img src="assets/images/LOGO_EUROMOTORS.png" alt="Logo" /></div>
<div class="container mt-4 bg-white p-4 rounded shadow">
  <a href="javascript:history.back()" class="btn btn-link mb-2">Volver</a>
  <h2 class="mb-4">Agregar nuevo producto</h2>
  <form #productForm="ngForm" (ngSubmit)="onSubmit(productForm)" novalidate>

    <div class="mb-3">
      <label class="form-label">Nombre del producto</label>
      <input type="text" class="form-control" [(ngModel)]="product.name" name="name" required #name="ngModel"
        [class.is-invalid]="name.invalid && (name.touched || formSubmitted)" />
      <div class="invalid-feedback" *ngIf="name.invalid && (name.touched || formSubmitted)">
        El nombre del producto es obligatorio.
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Descripci√≥n</label>
      <textarea class="form-control" [(ngModel)]="product.description" name="description" required></textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">Precio</label>
      <input type="number" class="form-control" [(ngModel)]="product.price" name="price" required />
    </div>

    <div class="mb-3">
      <label class="form-label">Marca</label>
      <select class="form-select" [(ngModel)]="product.category" name="category" required #category="ngModel"
        [class.is-invalid]="category.invalid && (category.touched || formSubmitted)">
        <option value="" disabled>Seleccione marca</option>
        <option *ngFor="let b of brandOptions" [value]="b">{{ b }}</option>
      </select>
      <div class="invalid-feedback" *ngIf="category.invalid && (category.touched || formSubmitted)">
        La marca del producto es obligatoria.
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Tipo de repuesto</label>
      <select class="form-select" [(ngModel)]="product.type" name="type" required #type="ngModel"
        [class.is-invalid]="type.invalid && (type.touched || formSubmitted)">
        <option value="" disabled>Seleccione tipo</option>
        <option *ngFor="let t of typeOptions" [value]="t">{{ t }}</option>
      </select>
      <div class="invalid-feedback" *ngIf="type.invalid && (type.touched || formSubmitted)">
        El tipo de repuesto es obligatorio.
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Imagen principal</label>
      <input type="file" class="form-control" accept="image/*" (change)="onMainImageSelected($event)"
        [class.is-invalid]="mainImage.invalid && formSubmitted" />
      <input type="hidden" name="mainImage" [(ngModel)]="product.image" #mainImage="ngModel" required />
      <div class="invalid-feedback d-block" *ngIf="mainImage.invalid && formSubmitted">
        La imagen principal es obligatoria.
      </div>
      <div class="mt-2" *ngIf="product.image">
        <img [src]="product.image" alt="preview" style="max-height:100px; border:1px solid #ccc; border-radius:8px;" />
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Imagenes adicionales</label>
      <input type="file" class="form-control" accept="image/*" multiple (change)="onAdditionalImagesSelected($event)" />
      <div class="d-flex gap-2 flex-wrap mt-2" *ngIf="product.images?.length">
        <div class="position-relative" *ngFor="let img of product.images; let i = index" style="display:inline-block;">
          <img [src]="img" alt="img" style="height:70px; width:auto; border:1px solid #ddd; border-radius:6px;" />
          <div class="btn-group btn-group-sm" style="position:absolute; top:4px; right:4px;">
            <button type="button" class="btn btn-light" title="Principal" (click)="setAsMain(i)"><i class="bi bi-star-fill"></i></button>
            <button type="button" class="btn btn-light" title="Izquierda" (click)="moveImageLeft(i)"><i class="bi bi-arrow-left"></i></button>
            <button type="button" class="btn btn-light" title="Derecha" (click)="moveImageRight(i)"><i class="bi bi-arrow-right"></i></button>
            <button type="button" class="btn btn-danger" title="Eliminar" (click)="removeImage(i)"><i class="bi bi-x"></i></button>
          </div>
        </div>
      </div>
    </div>

    <div class="form-check form-switch mb-4">
      <input class="form-check-input" type="checkbox" role="switch" id="featuredSwitch"
        [(ngModel)]="product.featured" name="featured" />
      <label class="form-check-label" for="featuredSwitch">Destacar producto</label>
    </div>

    <button type="submit" class="btn btn-outline-brand" [disabled]="isSaving">
      {{ isSaving ? 'Guardando...' : 'Guardar producto' }}
    </button>
  </form>
</div>
